{% extends "base.html" %}
{% block extra_head_content  %}
	{% load static %}
	<link rel="stylesheet" type="text/css" href="{% static 'css/account.css' %}" />
{% endblock %}
{% block js %}
<script src="../../../static/js/Chart.js"></script> 
<script src="../../../static/js/Colors.js"></script> 
{% endblock %}

{% block title_h1 %} Accueil {% endblock %}
{% block principal_section %}
<article>
<h3> Dépense des 12 derniers mois </h3>
<div class="width_all">
	<canvas id="linechart" height="200" width=600"></canvas>
	<canvas id="barchart" height="200" width=600"></canvas>
</div>
</article>

<article class="piechart">
<h3> Moyenne à l'année </h3>
<div class="width_half">
	<canvas id="piechart1" height="100" width="100"></canvas>
</div>
</article>

<article class="piechart">
<h3> Moyenne du mois </h3>
<div class="width_half">
	<canvas id="piechart2" height="100" width="100"></canvas>
</div>
</article>

<script>
(function(){
	// Definition couleurs
	var $id = function(id){
		return document.getElementById(id);
	    };

	// paramètre graphique en ligne
	var lineData = {
	labels : [ "{{triples.0.month_word}} {{triples.0.year}}",
               "{{triples.1.month_word}} {{triples.1.year}}",
               "{{triples.2.month_word}} {{triples.2.year}}",
               "{{triples.3.month_word}} {{triples.3.year}}",
               "{{triples.4.month_word}} {{triples.4.year}}",
               "{{triples.5.month_word}} {{triples.5.year}}",
               "{{triples.6.month_word}} {{triples.6.year}}",
               "{{triples.7.month_word}} {{triples.7.year}}",
               "{{triples.8.month_word}} {{triples.8.year}}",
               "{{triples.9.month_word}} {{triples.9.year}}",
               "{{triples.10.month_word}} {{triples.10.year}}",
               "{{triples.11.month_word}} {{triples.11.year}}", ],

	datasets : [

    {% for cat, vals in total_by_month.items %}
               {% if cat.name == "Gain" or cat.name == "Total" %}
		{
            label: "{{ cat.name }}",
            fillColor: "{{ cat.metadata.colors.verylight }}",
            strokeColor: "{{ cat.metadata.colors.light }}",
            pointColor: "{{ cat.metadata.colors.normal }}",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: {{ vals }},
		},
               {% endif %}
    {% endfor %}

	]
};

	var ctx1 = document.getElementById("linechart").getContext("2d");
	myLine = new Chart(ctx1).Line(lineData, {
			responsive: true, scaleShowGridLines : true
	})

	// paramètre graphique en bar
	var barData = {
	labels : [ "{{triples.0.month_word}} {{triples.0.year}}",
               "{{triples.1.month_word}} {{triples.1.year}}",
               "{{triples.2.month_word}} {{triples.2.year}}",
               "{{triples.3.month_word}} {{triples.3.year}}",
               "{{triples.4.month_word}} {{triples.4.year}}",
               "{{triples.5.month_word}} {{triples.5.year}}",
               "{{triples.6.month_word}} {{triples.6.year}}",
               "{{triples.7.month_word}} {{triples.7.year}}",
               "{{triples.8.month_word}} {{triples.8.year}}",
               "{{triples.9.month_word}} {{triples.9.year}}",
               "{{triples.10.month_word}} {{triples.10.year}}",
               "{{triples.11.month_word}} {{triples.11.year}}" ],
	datasets : [

    {% for cat, vals in total_by_month.items %}
    {
        label           : "{{ cat.name }}",
        fillColor       : "{{ cat.metadata.colors.normal }}",
		strokeColor     : "{{ cat.metadata.colors.light }}",
		highlightFill   : "{{ cat.metadata.colors.light }}",
		highlightStroke : "{{ cat.metadata.colors.verylight }}",
        data            : {{ vals }}
        
    },
    {% endfor %}
	]
};

	var ctx2 = document.getElementById("barchart").getContext("2d");
	myBar = new Chart(ctx2).Bar(barData, {
			responsive: true, scaleShowGridLines : true
	})

	// Definitions camemberts
	var canvas_pie1 = $id('piechart1'),
	    canvas_pie2 = $id('piechart2'),
	    legendPie1  = $id('pielegend1'),
	    legendPie2  = $id('pielegend2'),
	    helpers     = Chart.helpers;

	var pieDataYear = [

        {% for cat, val in average.items %}
        {
            label      : "{{ cat.name }}",
            value      :  {{ val }},
            color      : "{{ cat.metadata.colors.normal }}",
            highlight  : "{{ cat.metadata.colors.light }}",
        },
        {% endfor %}

	];

	var pieDataMonth = [

        {% for cat, val in average_month.items %}
        {
            label      : "{{ cat.name }}",
            value      :  {{ val }},
            color      : "{{ cat.metadata.colors.normal }}",
            highlight  : "{{ cat.metadata.colors.light }}",
        },
        {% endfor %}

	];

	pieOptions = { 
		segmentStrokeColor: "#ebe8e4",
		tooltipTemplate: "<\%if (label){\%><\%=label\%>: <\%}\%><\%= value \%>€"
	};

	
	var myPie1 = new Chart(canvas_pie1.getContext('2d')).Pie(pieDataYear, pieOptions);
	var legendHolder1 = document.createElement('div');
	legendHolder1.innerHTML = myPie1.generateLegend();
	// Include a html legend template after the module doughnut itself
	helpers.each(legendHolder1.firstChild.childNodes, function(legendNode, index){
		helpers.addEvent(legendNode, 'mouseover', function(){
			var activeSegment = myPie1.segments[index];
			activeSegment.save();
			activeSegment.fillColor = activeSegment.highlightColor;
			myPie1.showTooltip([activeSegment]);
			activeSegment.restore();
		});
	});
	helpers.addEvent(legendHolder1.firstChild, 'mouseout', function(){
		myPie1.draw();
	});
	canvas_pie1.parentNode.parentNode.appendChild(legendHolder1.firstChild);

	var myPie2 = new Chart(canvas_pie2.getContext('2d')).Pie(pieDataMonth, pieOptions);
	var legendHolder2 = document.createElement('div');
	legendHolder2.innerHTML = myPie2.generateLegend();
	// Include a html legend template after the module doughnut itself
	helpers.each(legendHolder2.firstChild.childNodes, function(legendNode, index){
		helpers.addEvent(legendNode, 'mouseover', function(){
			var activeSegment = myPie2.segments[index];
			activeSegment.save();
			activeSegment.fillColor = activeSegment.highlightColor;
			myPie2.showTooltip([activeSegment]);
			activeSegment.restore();
		});
	});
	helpers.addEvent(legendHolder2.firstChild, 'mouseout', function(){
		myPie2.draw();
	});
	canvas_pie2.parentNode.parentNode.appendChild(legendHolder2.firstChild);

})();

</script>
{% endblock %}
